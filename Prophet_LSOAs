import pandas as pd
from prophet import Prophet
import matplotlib.pyplot as plt
from datetime import datetime, timedelta
from prophet.plot import plot_plotly, plot_components_plotly, add_changepoints_to_plot

LSOA = 'Barnet 001A'

df_LSOA = pd.DataFrame()

df_final = pd.read_csv('data/final.csv')
LSOA_list = df_final.columns.values[4:]

fig, axes = plt.subplots(nrows = 5, ncols = 9, figsize=(20,20))
axes = axes.flatten()

#range(len(LSOA_list))
for i in range(5):
    LSOA = LSOA_list[i]
    ward = int(LSOA[-3:-1])
    print(ward)
    df_LSOA[['ds','y']] = pd.read_csv('data/final.csv')[['ds',LSOA]]

    df_LSOA['cap'] = 10

    m= Prophet(growth='logistic')
    m.fit(df_LSOA)

    future = m.make_future_dataframe(periods=12, freq='m')
    future['cap'] = 10


    forecast = m.predict(future)
    for col in ['yhat', 'yhat_lower', 'yhat_upper']:
        forecast[col] = forecast[col].clip(lower=0.0)

    figbruh = m.plot(forecast, ax=axes[i])

plt.show()